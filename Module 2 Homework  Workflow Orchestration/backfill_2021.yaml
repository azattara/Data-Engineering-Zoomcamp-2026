id: backfill_2021
namespace: zoomcamp
description: >
  Backfill for NYC Taxi data for year 2021.
  Runs the main ELT flow for each taxi type and each month.

tasks:
  - id: foreach_taxi
    type: io.kestra.plugin.core.flow.ForEach
    values:
      - yellow
      - green
    tasks:

      - id: foreach_month
        type: io.kestra.plugin.core.flow.ForEach
        values:
          - "01"
          - "02"
          - "03"
          - "04"
          - "05"
          - "06"
          - "07"
        tasks:

          - id: trigger_subflow
            type: io.kestra.plugin.core.flow.Subflow
            namespace: zoomcamp
            flowId: 05_postgres_taxi_scheduled   # your main pipeline
            inputs:
              taxi: "{{parent.taskrun.value}}"   # yellow or green
              year: "2021"
              month: "{{taskrun.value}}"         # 01â€“12
